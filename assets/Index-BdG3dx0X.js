import{p as V,r as t,A as $,j as e}from"./index-B8FfOyal.js";import{S as n,s as r}from"./StatusEncomendaEnum-zTAOf9gk.js";import{B as G,A as H}from"./BlocoService-CIQ6Y3Yk.js";import{D as J}from"./DeleteModal-CqxjC73x.js";import{f as p}from"./format-cwXK75ha.js";const W=()=>{const h=V(),o=t.useContext($),[v,b]=t.useState([]),[c,N]=t.useState(""),[d,S]=t.useState(""),[i,g]=t.useState(""),[m,y]=t.useState(0),[l,C]=t.useState(null),[A,B]=t.useState([]),[w,D]=t.useState([]),[M,x]=t.useState(!1),[j,E]=t.useState(null);async function u(){try{const a=await r.listarEncomendasComFiltro({nome:c,bloco:d,apartamento:m,StatusEncomenda:l=="Selecione"?null:l,codBarra:i});b(a)}catch(a){console.error("Erro ao buscar moradores:",a)}}t.useEffect(()=>{async function a(){const s=await G.listarBloco(),L=await H.listarApartamento();B(s),D(L)}a(),u()},[c,d,m,l,i]);const F=()=>{h("Cadastro")},k=a=>{h(`Cadastro/${a}`)};async function I(a){var s=await r.lerEncomenda(a);s.dataEntregue=new Date,s.statusEncomenda=n.Entregue.value,await r.atualizarEncomenda(a,s),o.addAlert("Entrega realizada com sucesso","success"),await u()}const O=a=>{for(const s in n)if(n[s].value===a)return n[s].label;return""};async function R(a){try{await r.excluirEncomenda(a),o.addAlert("Encomenda excluída com sucesso","success"),await u()}catch(s){o.addAlert("Erro ao excluir encomenda","error"),console.error("Erro ao excluir encomenda:",s)}}const q=a=>{E(a),x(!0)},f=()=>{x(!1),E(null)},z=()=>{j&&(R(j),f())};return e.jsxs("div",{children:[e.jsx("h1",{children:"Lista de Encomendas"}),e.jsxs("div",{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"form-label",children:"Nome do Morador"}),e.jsx("input",{type:"text",placeholder:"Nome do Morador",className:"form-control",value:c,onChange:a=>N(a.target.value)})]}),e.jsxs("div",{className:"col-2",children:[e.jsx("label",{htmlFor:"filtroBloco",required:!0,className:"form-label",children:"Bloco"}),e.jsxs("select",{className:"form-select",id:"filtroBloco",value:d,onChange:a=>S(parseInt(a.target.value)),children:[e.jsx("option",{value:null,children:"Selecione"}),A.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{className:"col-2",children:[e.jsx("label",{htmlFor:"filtroApartamento",required:!0,className:"form-label",children:"Apartamento"}),e.jsxs("select",{className:"form-select",id:"filtroApartamento",value:m,onChange:a=>y(parseInt(a.target.value)),children:[e.jsx("option",{value:null,children:"Selecione"}),w.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"form-label",children:"Status Encomenda"}),e.jsxs("select",{value:l,className:"form-control",onChange:a=>C(a.target.value),children:[e.jsx("option",{value:null,children:"Selecione"}),Object.values(n).map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]})]}),e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"form-label",children:"Código de Barra"}),e.jsx("input",{type:"text",placeholder:"Código de Barra",className:"form-control",value:i,onChange:a=>g(a.target.value)})]})})]}),e.jsx("button",{onClick:F,className:"btn btn-primary mt-3 mb-3",children:"Nova Encomenda"}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"Status da Encomenda"}),e.jsx("th",{children:"Código da Encomenda"}),e.jsx("th",{children:"Data Recebida"}),e.jsx("th",{children:"Data Entregue"}),e.jsx("th",{children:"Alterar"}),e.jsx("th",{children:"Entregar"}),e.jsx("th",{children:"Excluir"})]})}),e.jsx("tbody",{children:v.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.nomeDestinatario}),e.jsx("td",{children:O(a.statusEncomenda)}),e.jsx("td",{children:a.codBarra}),e.jsx("td",{children:a.dataRecebida==null?"":p(new Date(a.dataRecebida),"dd/MM/yyyy")}),e.jsx("td",{children:a.dataEntregue==null?"":p(new Date(a.dataEntregue),"dd/MM/yyyy")}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-primary",onClick:()=>k(a.id),children:"Alterar"})}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-primary",onClick:()=>I(a.id),children:"Entregar"})}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-primary",onClick:()=>q(a.id),children:"Excluir"})})]},a.id))})]}),e.jsx(J,{isOpen:M,onClose:f,onConfirm:z,mensagem:"Você tem certeza que deseja excluir esta encomenda?"})]})};export{W as default};
