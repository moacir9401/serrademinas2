import{q as S,r as i,A as B,j as a}from"./index-Baw52cgS.js";import"./InputMask-D__sfL1O.js";import{s as D}from"./MoradorService-Ddrmdc0G.js";import{T as l,s as v}from"./TipoOcorrenciaEnum-BoTyqemK.js";import{B as g,A as w}from"./BlocoService-DNm1RMcC.js";class C{constructor(m=0,r="",s="",t="",u=l,p=new Date,h=""){this.Id=m,this.idMorador=r,this.idBloco=s,this.idApartamento=t,this.tipoOcorrencia=u,this.Data=p,this.descricao=h}}const z=()=>{const{ocorrenciaId:n}=S(),m=i.useContext(B),[r,s]=i.useState(new C),[t,u]=i.useState({});i.useState(!1);const[p,h]=i.useState([]),[x,f]=i.useState([]),[j,N]=i.useState([]);i.useEffect(()=>{async function e(){const o=await g.listarBloco(),c=await w.listarApartamento(),d=await D.listarMoradores();h(o),N(c),f(d)}try{e()}catch{console.error("Erro ao buscar Ocorrência:",error)}if(n){async function o(){try{const c=await v.lerOcorrencia(n);c.data&&(c.data=new Date(c.data)),s(c)}catch(c){console.error("Erro ao buscar Ocorrência:",c)}}o()}},[n]),r.tipoOcorrencia===l.Morador.value?(r.idBloco=null,r.idApartamento=null):r.tipoOcorrencia===l.Bloco.value?(r.idMorador=null,r.idApartamento=null):r.tipoOcorrencia===l.Apartamento.value&&(r.idMorador=null,r.idBloco=null);const O=async e=>{e.preventDefault();const o={id:r.id,idMorador:r.idMorador,idBloco:r.idBloco,idApartamento:r.idApartamento,tipoOcorrencia:r.tipoOcorrencia,data:r.Data,descricao:r.descricao};u({});const c=b();if(Object.keys(c).length>0){u(c);return}try{if(n){const d=await v.atualizarOcorrencia(n,o);m.addAlert("Ação Realizada com sucesso","success")}else{const d=await v.criarOcorrencia(o);m.addAlert("Ação Realizada com sucesso","success"),A()}}catch(d){console.error("Erro ao criar ocorrência:",d)}},b=e=>({}),A=()=>{s(ocorrencia)},M=e=>Object.keys(e).map(o=>a.jsx("option",{value:e[o].value,children:e[o].label},e[o].value));return a.jsxs("div",{className:"container",children:[a.jsx("h2",{children:"Criar Ocorrência"}),a.jsxs("form",{onSubmit:O,children:[a.jsxs("div",{className:"col-2",children:[a.jsx("label",{className:"form-label",children:"id"}),a.jsx("span",{id:"id",className:"form-control",children:r.id??0})]}),a.jsxs("div",{className:"row",children:[a.jsxs("div",{className:"col-4",children:[a.jsx("label",{className:"form-label",children:"Tipo de Ocorrência"}),a.jsxs("select",{value:r.tipoOcorrencia,className:"form-control",id:"tipoOcorrencia",onChange:e=>s({...r,tipoOcorrencia:parseInt(e.target.value)}),children:[a.jsx("option",{value:0,children:"Selecione"}),M(l)]})]}),r.tipoOcorrencia===l.Morador.value&&a.jsxs("div",{className:"col-3",children:[a.jsx("label",{htmlFor:"ocorrenciaId",className:"form-label",children:"Morador"}),a.jsxs("select",{value:r.idMorador,className:"form-control",id:"idMorador",onChange:e=>s({...r,idMorador:parseInt(e.target.value)}),children:[a.jsx("option",{value:0,children:"Selecione"}),x.map(e=>a.jsx("option",{value:e.id,children:e.nome},e.id))]}),t.idMorador&&a.jsx("div",{className:"invalid-feedback",children:t.idMorador})]}),r.tipoOcorrencia===l.Bloco.value&&a.jsxs("div",{className:"col-3",children:[a.jsx("label",{htmlFor:"IdBloco",className:"form-label",children:"Bloco"}),a.jsxs("select",{value:r.idBloco,className:"form-control",id:"idBloco",onChange:e=>s({...r,idBloco:parseInt(e.target.value)}),children:[a.jsx("option",{value:0,children:"Selecione"}),p.map(e=>a.jsx("option",{value:e.id,children:e.nome},e.id))]}),t.idMorador&&a.jsx("div",{className:"invalid-feedback",children:t.idMorador})]}),"  ",r.tipoOcorrencia===l.Apartamento.value&&a.jsxs("div",{className:"col-3",children:[a.jsx("label",{htmlFor:"IdApartamento",className:"form-label",children:"Apartamento"}),a.jsxs("select",{value:r.idApartamento,className:"form-control",id:"idApartamento",onChange:e=>s({...r,idApartamento:parseInt(e.target.value)}),children:[a.jsx("option",{value:0,children:"Selecione"}),j.map(e=>a.jsx("option",{value:e.id,children:e.nome},e.id))]}),t.idMorador&&a.jsx("div",{className:"invalid-feedback",children:t.idMorador})]}),a.jsxs("div",{className:"col-2",children:[a.jsx("label",{htmlFor:"dataNascimento",className:"form-label",children:"Data"}),a.jsx("input",{type:"date",id:"data",name:"data",value:r.data?r.data.toISOString().substring(0,10):"",onChange:e=>s({...r,data:new Date(e.target.value)}),className:t.data?"form-control is-invalid":"form-control"})]})]}),a.jsx("div",{className:"row",children:a.jsxs("div",{className:"col-12",children:[a.jsx("label",{htmlFor:"descricao",className:"form-label",children:"Descrição"}),a.jsx("textarea",{className:"form-control",rows:"5",id:"descricao",value:r.descricao,onChange:e=>s({...r,descricao:e.target.value})})]})}),a.jsx("button",{type:"submit",className:"btn btn-primary mt-3",children:"Salvar"})]})]})};export{z as default};
